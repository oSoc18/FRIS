<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/main.css">
</head>
<script src="js/jquery.js"></script>
<script src="js/d3.v5.min.js"></script>
<script src="js/function.js"></script>

<body>
    <div class="titletext">
        <h1 class>Demo page for FRIS - Flanders Research Information Space</h1>

    </div>
    <hr class="outline">

    <div id="demo">

        <input type="search" name="search" id="search_id" class="search__input" placeholder="Keyword : UGent">
    </div>
    <span></span>
    <svg id="canvas">

    </svg>

    <script>
        var svg = d3.select("svg");
        var keywordDetailled = ["IA", "Machine learning", "Pacman"]
        var root = {
            "name": "IA",
            "long_name": "Intelligence artificial",
            "children": ["AgglomerativeCluster",
                "CommunityStructure",
                "HierarchicalCluster",
                "Don't click me"
            ]
        };

        function init() {
            $.ajaxSetup({
                async: false
            });
            var svg = d3.select("svg"),
                width = svg.attr("width"),
                height = svg.attr("height"),
                g = svg.append("g").attr("transform", "translate(32," + (height / 2) + ")"),
                jsonData = readJSON('/static/research_outputs.json'),
                text = jsonData.wavelets,
                result = [];
            var radius = 50;
            var side = 2 * radius * Math.cos(Math.PI / 4),
                dx = radius - side / 2;
            var g = svg.append('g')
                .attr('transform', 'translate(' + [dx, dx] + ')');
            //first element
            svg.append("line")
                .attr("x1", 1065)
                .attr("x2", 750)
                .attr("y1", 350)
                .attr("y2", 350)
                .attr("stroke", "black")


            svg.append("text")
                .text(wrapWord(text[0]))
                .attr("x", 1120)
                .attr("y", 355)
                .attr("class", "text")
                .style('pointer-events', 'auto')
                .on("click", function () {
                    d3.event.stopPropagation();
                    var element = d3.select(this);
                    element.attr("class", "keyword-main");
                    createTextToNodes(element, root);

                })
            //second element
            svg.append("line")
                .attr("x1", 455)
                .attr("x2", 750)
                .attr("y1", 350)
                .attr("y2", 350)
                .attr("stroke", "black")


            svg.append("text")
                .text(wrapWord(text[1]))
                .attr("x", 410)
                .attr("y", 355)
                .attr("class", "text")
                .style('pointer-events', 'auto')
                .on("click", function () {
                    d3.event.stopPropagation();
                    var element = d3.select(this);
                    element.attr("class", "keyword-main");
                    createTextToNodes(element, root);

                })
            svg.append("line")
                .attr("x1", 750)
                .attr("x2", 750)
                .attr("y1", 350)
                .attr("y2", 640)
                .attr("stroke", "black")


            svg.append("text")
                .text(wrapWord(text[3]))
                .attr("x", 750)
                .attr("y", 655)
                .attr("class", "text")
                .style('pointer-events', 'auto')
                .on("click", function () {
                    d3.event.stopPropagation();
                    var element = d3.select(this);
                    element.attr("class", "keyword-main");

                    createTextToNodes(element, root);

                })
            svg.append("line")
                .attr("x1", 750)
                .attr("x2", 750)
                .attr("y1", 350)
                .attr("y2", 110)
                .attr("stroke", "black")


            svg.append("text")
                .text(root.name)
                .attr("x", 750)
                .attr("y", 100)
                .attr("class", "text")
                .style('pointer-events', 'auto')
                .on("click", function () {
                    d3.event.stopPropagation();
                    var element = d3.select(this);
                    element.attr("class", "keyword-main");
                    element.text(root.long_name);
                    createTextToNodes(element, root);

                })
            //Normally we use this
            /*
            for (var i in text) {
                result.push([i, text[i]]);
                console.log(text[i])
                createText(svg, text[i], i);
            }
            */
            svg.append("circle")
                .attr("r", 50)
                .attr("cx", 750)
                .attr("cy", 350)
                .attr("fill", "orangered")
                .attr("class", "borderCircle");
            svg.append("text")
                .attr("x", 750)
                .attr("y", 350)
                .text("Organization")
                .style("fill", "#eee")

        }

        function createText(svg, text, orientation) {
            var positionX = orientation * 300 + 400;
            var positionY = orientation * 100 + 100;
            var radiusCircle = 50;
            //This positionning is only for the demo 
            //it's static but we don't care about that until the demo is finish
            //Huhuhu



            //Old version, I need to randomize the positionning
            /* 
            svg.append("line")
                .attr("x1", positionX)
                .attr("x2", 750)
                .attr("y1", positionY)
                .attr("y2", 350)
                .attr("stroke", "black")


            svg.append("text")
                .text(text)
                .attr("x", positionX)
                .attr("y", positionY)
                .attr("class", "text")
                .style('pointer-events', 'auto')
                .on("click", function () {
                    d3.event.stopPropagation();
                    var element = d3.select(this);
                    element.attr("class", "keyword-main");
                    createTextToNodes(element, keywordDetailled);

                })
                */

        }

        function createTextToNodes(element, keywordDetailled) {
            //return the coordinates of the element
            var positionX = element.attr("x");
            var positionY = element.attr("y");
            var count = 1; //size of array
            var svg = d3.select("svg");

            for (var i = 0; i < keywordDetailled.children.length; i++) {

                svg.append("line")
                    .attr("x1", positionX)
                    .attr("x2", (positionX / 2) + (i * 250))
                    .attr("y1", positionY - 20)
                    .attr("y2", positionY - 50)
                    .attr("class", "textFadeIn")
                    .attr("stroke", "grey");
                svg.append("text")
                    .text(keywordDetailled.children[i])
                    .attr("x", (positionX / 2) + (i * 250))
                    .attr("y", positionY - 50)
                    .attr("class", "textFadeIn")
                    .style('pointer-events', 'auto')
                    .on("click", function () {
                        d3.event.stopPropagation();
                        alert("\t¯\\_(ツ)_/¯\nDON'T CLICK ME !")
                    });
            }

        }
        $(document).ready(init);
    </script>

</body>

</html>